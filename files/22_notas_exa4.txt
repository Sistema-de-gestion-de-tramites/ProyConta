-workshop
exploring the oracle database architecture
----------------------------------------------- 01/09/22
comados;
ps (estado de proceso)
host (en sqlplus(regresa al SO))
top (monitor de procesos)
wc (cuenta palabras,lineas,ect)
grep (busca patrones en un file)

--------------------------------------   02/09/22
free mem -h (memoria libre)
ps -fea | grep pmom (monitgor de instancia)
+SQL+ show user (conque usuario estoy conectado)
+sql+ select * from v$version;
+sql+ select sum(value)/1024/1024 SGA_MB from v$sga
++
describe v$session

select username from v$session where username is not null
---------------------------------------- 05/09/22
*shared sql area hace los sioguiente*
1.- pparser
a) analisis lexico,etc.
b) existencia de objeto
c) permisos
2.-execute
a) plan de ejecucion(estadisiticas) hacia uun cursos implito
b) se deposita el reu
-analize table emp compute statitics;
c)fecth
-show parameter (shared, sga, log_buffer)

******************************************
virtualizar oracle linux 8 o 7
60  gb de espacio libre (bitacora de como instalar)
oraclle.itq.edu.mx
dhcp
------------------------------------ 06/09/22
show parameter db_block_size
show parameter db_cache_size
¿que almacena database buffer cache?
bloques de datos
¿que es una instancia?
estructuras de memoria + procesos de backgroud
+save d20;
+@d20;
[ debe de existir 2 usuarios: usuario propietario o de esquema
usuario de conexion]

----------------------------------- 07/09/22
++ ps -fea | grep orcl
++ ps -fea | grep oracleorcl
conne / as sysdba
++ select username, osuser, machine from v$session where username is not null
----------------------------------- 08/09/22

----------------------------------- 09/09/22
++archive log list (donde estan los archivos)
select name from v$controlfile;
select name from v$datafile;
system: diccionario de datos
sysaux: 
undotbs1: imagen de tablas viejas
user/examples: almacenar tablas
select member from v$logfile
select member from v$log
col member for a50;

select name
from v$controlfile
union
select name
from v$logfile
----------------------------------- 12/09/22
+show parameter
+env / enverioment
+echo $(variable de entorno)
+du -bsh
df -h
------------------------------------ 13/09/22
%oracle_home/dbs <-- ruta de parameter files
cuando la base de datos inicia primero busca spfile**.ora sin no esta init**.ora
select name from $database
crear init o spifile
create pfile from spfile;
shudown immediate
startup
rman (herramienta de respaldos)
archive log list <--- saber si tienes archivamiento
select * from v$pwfile_users;
orapwd file=orapwfact passwor
------------------------------------ 15/09/22
**¿cuales son los archivos que conforman la BD?
control files, data files, online redo log files
alert log & trace files
puede rastrear: so,bd,usuarios
++show parameter dump
********** EXAMEN 23/09/22*********
++df -h (define file system)
¿si se usa data life hasta de ? ¿tablaspace puede tener hasta--
1023 data file de 32 gigas
++select name from v$tablespace
---------------------------------- 19/09/22
data block->8k version 10g en adelante
select name from v$tablespace;
create tablespace  inventory;
create tablespace calidad datafile size 200m;
drop tablespace nombre;
create tablespace calidad datafile ().
alter user hr quota unliimted om calidad

create table hr.indicadores
{
indicador_id number(2),
indicador varchar2(40)
}

select table_name, tablespace
from user_tables;

select segment_name, tablespace_name from
from user_segments;

purge recyclebin; (limpia papelera de reciclaje)

col segment_name for a30 (reformatea una columna (hacerlo mas chico))

trunkate emp; (desaloja todas las extenciones y lo deja con la de defecto)
---------------------------------------------
automatic storage magnament
RAy
mirar los grupos de discos:
. oraenv
ASM
asmcmd
-- ls -l
asm allocation unit -> 1 mb hasta 64 mb (en multiplo de 2)
asm extent -> conformado por asm allocation unit
lsdg
la base de datos puede almacenar datafiles dentro de asm
la base de datos escucha (listener) por el puerto 1521
para asignar un server process
el archivo de control almacena el mapa de la base de datos.
la base de datos tiene 2 usuarios
el de esquema y el de usuario (aplicativo)
dominio de BD orcl.itq.edu

########### UNIDAD 4 #######################
dbca
general purpose or transaction
global database name: conta .oracle.sta.edu.mx
use the same administraative pass
store type: file system
use common location for al database files
crear un archivo raiz /u02
chown oracle:ointall u02
#u02
mkdir oradata
fra: dejar ruta
recovey area size: 8 mb / lo que aparesca
samples schemas
memory size (SGA & PGA) 250 m
sizing->process:100
charater sets->use unicode
conn mode -> dedicated server mode
---
/etc
oratab (todas las bases de datos del servidor)
------------------------------------------------ 03/10/22
 oraenv -> cambiar de base de datos (ambientar)
ls -ltr -> ?
. -> comando punto ejecuta un shell, variable sh tambien hace lo mismo
./ -> busca en el directorio espeficado el shell especificado
los demas/ grupo/ propietario
find -> buscar
find /u01 -name oraenv -print
emctl start dbconsole
emctl stop dbconsole
levanta serie de procesos para que enterprise manager se pueda conectar

alter use hr identified by oracle account unlock; -> desbloquear una cuenta
** hay usuarios que monitorean la base de datos
sysman, sysdb, etc .....
------------------------------------------------------- 04/10/22
comandos linux
sqlplus user/pass <<EOF
querys
EOF
comandos linux
. demo.sh >> demo.log -- la salida se guarda en demo.log
sqlplus system/oracle@conta --accede a la base de datos conta sin ambientar (cambiar oracle sid)
---------------------------------------------------05/10/22
alter session nls_date_format = "dd-mon-yyyy"
alter system set process = 250 scope=spfile;
shutdown inmmediate
startup
alter database mount; (si se inicia la base con otro modo como no mount se puede cambiar con este comando)
--------------------------------------------------- 06/10/22
srvctl utility with oracle restart
srvctl start database -d orcl -o mount (si se cae la base de datos se inicia en automatico)
*** ps - fea | grep pmon (mirar los procesos de las bases de datos para ver cuales estan en ejecucion)
***ver tabla de parametros shutdown en material
archivo que ejecuta comandos siempre que se incia una session de base de datos
-- ed login (login.sql)
recover database (comando normal para recuperar la bd)
--------------------------------------------------- 07/10/22
tarea:
consultar alert log en sqlplus
**desc X$DBGALERTEXT
$oracle_home/dbms/admin -> ubicacion de shells para administrar
@oracle_home/rdms/admin/awrrpr
healt monitor
v$fixed_table, cuall es la vista que muestra todos los nombred 
select * from diccionary -> vista de diccionario de datos
que prefijo me permite ver mis objetos: user_
---------------------------------------------------
################### unidad 5##########################
----------------------------------------------- 14/10/22
ps -fea | grep orcl | wc - l
ps -fea | grep asm | wc - l
procesos de instancia dba :342 ; asm:72
reorganizamiento de balanceo de discos de tipo lento y rapido.
show parameter instace_type; (tipo de instancia que me encuentro).
asm_power_limit (velocidad de balanceo 1-n);
ASM_prefered_read_failure_groups (ver si hay grupos de fallo)
v$fixed_tables; (vista dinamica que muestra todas las tablas)
------------------------------------------------ 17/10/22
(ambientado con ASM)
##sqlplus
desc v$asm_disk;
(informacion de discos como redundancia y mas)
#######
ed
r
#########
----------------------------------------------- 18/10/22
select * from v$pwfile_users;
(vsualizar archivo de password)
borrar y recrear archivo de passwords
cd $oracle_home/dbs
rm orapworcl
orapwd file=$oracle_home/dbs/orapworcl password=oracle entries=10

en sys as sysasm
shutdown immediate;
(se necesita bajar las instancias de bd que esten usando el asm)
select * from v$asm_client;
(ver que instancias estan conectadas)
para iniciar instancias de bd que usen asm, asm debe estar levantado.
srvctl stop asm -f
detener asm y forzar para que las bd conectadas tambien las baje
srvctl status asm / srvctl status database -d orcl
(ver estado de instancias)
*********** requisitos para virtualizar **********
4 discos mas (4 gb)
particionar y  etiquetar
**************************************************

----------------------------
ambientarse en una bd
iniciar bd con srvctl con un estado de apertura
cambiar valor de una parametro
(alter system set <parameter>=<valor> scope=<destino>)
ver el tamaño del sga

################### UNIDAD 6 ###############################
----------------------------------------------------------- 25/10/22
SQL> Connect hr/hr@[url/IP]:[1521]/dbg11

lsnrctrl status
(visualiza el nombre de servicio de la BD)

ps -fea | grep tnslsnr
(listeners en ejecucion)

netca
(configuracion de la red para las BD de oracle)

.oraenv
+ASM (ambientar correctamente)
cd $ORACLE_HOME/network/admin  -> listener.ora
(archivo de configuracion  de listener)


tnsnames (archivo de configuracion de red)
cd $ORACLE_HOME/network/admin -> tnsnames.ora
-----------------------------------------------------------------
. oraenv
+asm
cd $oracle_home/network/admin
qlsnet.ora
-----------------------------------------------------------------
que es ASM
{Automatic Storage Magnament}
como se llama el parameter de spifale para definir la velocidad de rebalanceo
{ASM_POWER_LIMIT (1-9)}
que es redundancia normal y externa
{externa:no hay failgroups y no hay mirroring de datos
interna: 2 failgroups, mirroring de extenciones 1
high: 3 failgroups, mirroring de extenciones 2
}
vista balanceo que esta sucediendo ahora
{v$ASM_operation}
que hace sysdba y que hace sysasm
{sysasm: privilegios administrativos completos para la instancia de asm
sysdba: acceso a los datos alamcenados en asm, en la version actual hereda los privilegios de sysasm}
como ver el status de del asm con el srvctl
{srvctl status asm}
que es disco,unidad de alojamiento{
disco: dispositivo de almacenamiento provisinado para un diskgroup, puede ser disco fisico entero o una particion de este
unidad de alojamiento: unidad de memoria en la cual esta dividida un disco de ASM, valor de 1-64 mb}
granularidad fina
{coloca unidades fraccionadas de 128 KB en grupos de unidades de asignación para mejorar la latencia.}
borrar diskgropu
{drop diskgroup <nombreDeDiskgroup>}
borrar disco
{ALTER DISKGROUP <nombreDeDiskgroup> DROP DISK <nombreDeDisco>;}

-------------------------------------------------------------------
archivo, bloque, registro {rowid informacion}
package dbms_rowid (infromacion de row_id)


select rownum, department_name, rowid,dbms_rowid.rowid_block_number(rowid) from &tabla;

[desc user_tables]
pct_free
pct_used
(informacion del espacio de uso de bloque)
---------------------------------------------------------------- 10/11/22

[desc user_tables]
chain_ct (muestra estadisiticamente si hay encadenamiento en la tabla (si esta fragmentada))

analyze table emp compute statisitcs; (realizar estadisticas a una tablas)

***recontruyo la tabla***
alter table emp move; muevo la tabla al mismo tablespace
alter table emp move <nombre del tablespace>;

**creacion de tablespcae**7
create tablespace factura; -> administracion de onmbres automotica
-> si no esta activada la admistracion de nombres por Oracle se tiene que especificar mas informacion en la creacion de una tablespace
** ver ruta de datafiles
select file_name from dba_data_files;

create tablescpace factura datafile '<direccion datafile>[de preferencia que sea la misma direccion y nomenclatura de los otros datafiles]'
size 50m 

** estatus y nombre de los tablespace**
select tablespace_name,status from dba_tablespaces;

** modificar tablespace
alter tablespace <facturas> offline
alter tablespace calidad read only;
alter tablespace calidad read write;


si un tablespace se esta llenndo
*agregar mas datafiles
*agregar mas espacio al datafile (no mayor a 32 gb)
*puede ser automatico si la opcion esta activada

** ver como esta creado un objeto
-- pa que se vea chido
set long 200000
set pages 0
dbms_metadata.get_ddl('tablespace','factura') from dual;

** dar permisos a un usuario para escribir en un tablescpace
alter user hr quota unlimited factura

** borrar un tablespace
drop tablespace <demo>;
si no hay tablas
drop tablespace <demo> including contents;
---------------------------------------------------------------- 11/11/22

* anadir un datafile
create tablespace <factura>;
[de esta manera el tamaño por defaut es 100 mb]
** ver donde se creo el datafile
select file_name from dba_data_files;
** nuevo datafile
alter tablesspace <facturas> add datafile | <size>m;
** extender tamaño de un datafile (ccon un maximo de 32gb)
alter database datafile '<file_directory>' resize <size>m;


** espacio libre en tabla
dba_free_space
---------------------------------------------------------------------
############################ UNIDAD 5 ##############################
--------------------------------------------------------------28/11/22
++Sys propietario del diccioario de datos y AWR
select * from dba_profiles;
grant create session to luis;
select table_name from all_tables; (ver todas las tablas del usuario conectado)
show user;
show parameter prefix
create user ops$<name> identified by externally;
(crear usuario auntenticado con el sistema operativo);
{necesita existir el usuario al nivel sistema operativo};
desc v$pwfile_users;
(usuario administradores)
alter user luis identified by <password>
(resetear/cambiar contraseña)
++alter user luis account <unlock/lock>;
------------------------------------------------------------ 29/11/22
create table (crear tabla en esquemas propiertario)
create any table (crear tablas en cualquier esquema)
<with admin option> (puede otorgar el privilegio que resivio a otros usuarios)
user_sys_privs (privilegios de un usuario)
user_role_privs (roles de un usuario)
select * from role_sys_privs; (privilegios de un role)
----------------------------------------------------------- 30/11/22
[los usuarios tienen solamente un perfil]
select * from user_profile;
select * from dba_profiles; (perfiles)
IDLE_TIME(from resource name of resource type kernel in dba_profiles {tiempo que puede un usuario estar inactivo antes de ser desocnectado de manera automatica})
$oracle_home/rdbms/admin/utlpwdmg.sql

**create profile
alter profile desarrollo limit
<parameter/directiva de seguridad> <value>;

alter user <luis> profile desarrollo
----------------------------------------------------------- 01/12/22
create larissa indetified by oracle
quota unlimited on users
quota 5m on example;
dba_ts_quotas {vista de quotas}
show parameter remote {columna os_remote_connect[para metro de conexiones remotas]}
---------------------------------------------------------------------